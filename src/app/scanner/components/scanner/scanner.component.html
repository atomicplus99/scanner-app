<!-- src/app/components/scanner/scanner.component.html -->
<section class="scanner-section" [class.dark-mode]="darkMode()">
  <!-- Cabecera con diseño modernizado -->
  <div class="scanner-header">
    <h2 class="scanner-title">
      <span class="icon-scan">
        <svg class="scan-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
          <path d="M8 8h.01M16 8h.01M8 16h.01M16 16h.01"></path>
        </svg>
      </span>
      <span>Escáner QR</span>
    </h2>
    
    <div class="scanner-status-info" [class.error]="scannerError()" [class.success]="isScanning() && !scannerError()" *ngIf="isScanning()">
      <div class="status-indicator"></div>
      <span class="status-text">{{ scannerStatus() }}</span>
      
      <div *ngIf="videoWidth() && videoHeight()" class="resolution-info">
        <svg class="resolution-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="18" height="18" rx="2"></rect>
          <line x1="3" y1="9" x2="21" y2="9"></line>
          <line x1="9" y1="21" x2="9" y2="9"></line>
        </svg>
        <span class="resolution-text">{{ videoWidth() }}x{{ videoHeight() }}</span>
      </div>
    </div>
  </div>
  
  <!-- Selector de cámara con diseño mejorado -->
  <div class="camera-selector" *ngIf="availableCameras().length > 1">
    <div class="selector-container">
      <label for="camera-select" class="select-label">
        <svg class="camera-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
          <circle cx="12" cy="13" r="4"></circle>
        </svg>
        <span>Seleccionar cámara</span>
      </label>
      
      <div class="select-wrapper">
        <select
          id="camera-select"
          [disabled]="isScanning()"
          (change)="onCameraChange($event)"
          class="camera-select"
        >
          <option *ngFor="let camera of availableCameras()" [value]="camera.deviceId">
            {{ camera.label || 'Cámara ' + (camera.deviceId ? '#' + camera.deviceId.substr(0, 5) : '') }}
          </option>
        </select>
        <div class="select-arrow">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Contenedor principal del escáner con efectos visuales mejorados -->
  <div class="scanner-container">
    <!-- Área de visualización del escáner -->
    <div class="video-container" #qrRegionElement>
      <video #videoElement class="scanner-preview" [class.scanning]="isScanning()" playsinline></video>
      <canvas #canvasElement style="display: none;"></canvas>
      
      <!-- Overlay del escáner con animaciones mejoradas -->
      <div class="scanner-overlay" *ngIf="isScanning()">
        <div class="scanner-frame">
          <!-- Esquinas animadas -->
          <div class="corner top-left"></div>
          <div class="corner top-right"></div>
          <div class="corner bottom-left"></div>
          <div class="corner bottom-right"></div>
          
          <!-- Línea de escaneo animada -->
          <div class="scanner-line"></div>
          
          <!-- Círculos de pulso -->
          <div class="scan-pulse"></div>
        </div>
        
        <!-- Partículas de fondo -->
        <div class="particle-container">
          <div class="particle p1"></div>
          <div class="particle p2"></div>
          <div class="particle p3"></div>
          <div class="particle p4"></div>
          <div class="particle p5"></div>
        </div>
      </div>
      
      <!-- Indicador de estado flotante -->
      <div class="floating-status" [class.success]="isScanning() && !scannerError()" [class.error]="scannerError()" [class.active]="isScanning()">
        <div class="status-icon" *ngIf="scannerError()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="15" y1="9" x2="9" y2="15"></line>
            <line x1="9" y1="9" x2="15" y2="15"></line>
          </svg>
        </div>
        <div class="status-icon" *ngIf="isScanning() && !scannerError()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
            <polyline points="22 4 12 14.01 9 11.01"></polyline>
          </svg>
        </div>
        <div class="status-message">{{ scannerError() || scannerStatus() }}</div>
      </div>
    </div>
    
    <!-- Panel de notificación para errores con diseño mejorado -->
    <div class="notification-panel" *ngIf="scannerError()">
      <div class="notification-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12" y2="16"></line>
        </svg>
      </div>
      <div class="notification-content">
        <div class="notification-title">Error del escáner</div>
        <div class="notification-message">{{ scannerError() }}</div>
      </div>
    </div>
  </div>
  
  <!-- Controles del escáner con diseño mejorado y efectos de hover -->
  <div class="scanner-controls">
    <button
      class="control-btn primary-btn"
      [class.active]="isScanning()"
      (click)="toggleScanner()"
      aria-label="Controlar escáner"
    >
      <div class="btn-content">
        <div class="btn-icon">
          <svg *ngIf="!isScanning()" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polygon points="5 3 19 12 5 21 5 3"></polygon>
          </svg>
          <svg *ngIf="isScanning()" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="6" y="4" width="4" height="16"></rect>
            <rect x="14" y="4" width="4" height="16"></rect>
          </svg>
        </div>
        <span class="btn-text">{{ isScanning() ? 'Detener escáner' : 'Iniciar escáner' }}</span>
      </div>
      <div class="btn-background"></div>
    </button>
    
    <button
      *ngIf="hasTorch()"
      class="control-btn torch-btn"
      [class.active]="torchEnabled()"
      [disabled]="!isScanning()"
      (click)="toggleTorch()"
      aria-label="Controlar linterna"
    >
      <div class="btn-content">
        <div class="btn-icon">
          <svg *ngIf="!torchEnabled()" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M15 14l-4-4M16 4l4 4M12 2v3M2 12h3M4 20l4-4M20 4l-4 4M19 12h3M12 19v3M8 8l-4 4"></path>
          </svg>
          <svg *ngIf="torchEnabled()" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="5"></circle>
            <line x1="12" y1="1" x2="12" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="23"></line>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
            <line x1="1" y1="12" x2="3" y2="12"></line>
            <line x1="21" y1="12" x2="23" y2="12"></line>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
          </svg>
        </div>
        <span class="btn-text">{{ torchEnabled() ? 'Apagar linterna' : 'Encender linterna' }}</span>
      </div>
      <div class="btn-background"></div>
    </button>
  </div>
  
  <!-- Indicador de preparación del escáner -->
  <div class="scanner-ready-indicator" *ngIf="!isScanning()">
    <div class="ready-circle"></div>
    <div class="ready-text">Escáner listo</div>
  </div>
</section>